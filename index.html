<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Workflow Agent - å¯åŠ¨å¡ç‰‡æ”¶ç¼©åˆ°å·¥ä½œå°ï¼ˆè¾“å…¥å±…ä¸­åœ¨å·¦æ ï¼Œå«è¯„åˆ†ï¼‰</title>
  <style>
    :root{
      --bg:#f7f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --primary:#111827;
      --accent:#3b82f6; /* æ”¹ä¸ºè“è‰²ä¸»é¢˜ */
      --accent-weak:#dbeafe; /* è“è‰²å¼±åŒ–ç‰ˆæœ¬ */
      --progress:#3b82f6; /* è¿›åº¦æ¡ä¹Ÿæ”¹ä¸ºè“è‰² */
      --line:#d1d5db;
      --node-bg:#fafafa;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:linear-gradient(180deg,#fff, var(--bg));
      overflow:hidden;
    }

    .stage{position:relative;height:100vh;width:100%}

    /* Phase 1ï¼šå…¨å±å¯åŠ¨ç•Œé¢ */
    .launch{
      position:fixed;inset:0;z-index:30;
      display:flex;background:var(--bg);
      transition:opacity .3s ease,transform .3s ease;
    }
    .launch-left{flex:0 0 15%;background:var(--card);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
    .launch-right{flex:1;background:var(--card);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:80px 120px;width:100%}
    .logo{display:flex;align-items:center;gap:16px;margin-bottom:1.5rem}
    .logo-badge{width:44px;height:44px;border-radius:11px;background:linear-gradient(135deg,#3b82f6,#60a5fa);display:grid;place-items:center;color:#1e40af;font-weight:900;font-size:17px;box-shadow:0 6px 20px rgba(59,130,246,.35)}
    .logo-title{margin:0;font-size:26px;font-weight:800;letter-spacing:-0.3px}
    .launch .hint{font-size:15px;color:var(--muted);margin-top:0.5rem;text-align:center;max-width:700px;line-height:1.6;padding:0 20px}
    .form{display:flex;gap:16px;align-items:center;width:100%;max-width:750px;margin-bottom:0}
    .input{flex:1;padding:18px 22px;border:1px solid var(--border);border-radius:15px;font-size:15px;outline:none;transition:box-shadow .2s,border-color .2s;min-height:52px}
    .input:focus{border-color:#93c5fd;box-shadow:0 0 0 3px var(--accent-weak)}
    .btn{padding:18px 28px;background:var(--primary);color:#fff;border:none;border-radius:15px;font-size:15px;cursor:pointer;transition:transform .06s,opacity .2s,background .2s;font-weight:600;min-height:52px;white-space:nowrap}
    .btn:hover{background:#000}
    .btn:active{transform:translateY(1px)}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    /* å¯åŠ¨é¡µï¼šæ ‡ç­¾ä¸å¹¿åœºæ ·å¼ */
    .tabs{display:flex;gap:8px;border-bottom:1px solid var(--border);padding-bottom:6px;margin-bottom:6px}
    .tab{padding:8px 10px;border-radius:10px;cursor:pointer;font-size:13px;color:#1f2937;background:#f3f4f6;border:1px solid var(--border);transition:filter .15s,transform .06s}
    .tab:hover{filter:brightness(0.98)}
    .tab:active{transform:translateY(1px)}
    .tab--active{background:var(--accent-weak);border-color:#bfdbfe;color:#1e40af;font-weight:700}
    .tab-panels{display:block}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .left-header{padding:20px 16px 16px 16px;border-bottom:1px solid var(--border)}
    .left-title{margin:0 0 12px 0;font-weight:800;font-size:16px;color:#0f172a}
    .left-content{flex:1;padding:16px;overflow:auto}
    
    /* å¯¼èˆªæŒ‰é’®æ ·å¼ */
    .nav-buttons{display:flex;flex-direction:column;gap:12px}
    .nav-btn{display:flex;align-items:center;gap:12px;width:100%;padding:12px 16px;border:1px solid var(--border);border-radius:12px;background:#fff;color:#374151;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;text-align:left}
    .nav-btn:hover{background:#f8fafc;border-color:#c7d2fe;color:#1e40af;transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .nav-btn:active{transform:translateY(0);box-shadow:0 1px 4px rgba(0,0,0,.12)}
    .nav-icon{font-size:18px;flex-shrink:0}
    .nav-text{flex:1}

    /* å¹¿åœºé¡µé¢æ ·å¼ */
    .square-page{position:fixed;inset:0;z-index:30;display:flex;flex-direction:column;background:var(--bg);opacity:0;transform:translateX(20px);transition:opacity .3s ease,transform .3s ease;pointer-events:none}
    .square-page.visible{opacity:1;transform:translateX(0);pointer-events:auto}
    .square-header{display:flex;align-items:center;gap:16px;padding:20px 24px;border-bottom:1px solid var(--border);background:var(--card)}
    .back-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:8px;background:#fff;color:#374151;font-size:14px;cursor:pointer;transition:all .2s ease}
    .back-btn:hover{background:#f8fafc;border-color:#c7d2fe;color:#1e40af}
    .square-title{margin:0;font-size:20px;font-weight:700;color:#111827}
    .square-content{flex:1;padding:24px;overflow:auto}
    .square-toolbar{display:flex;flex-direction:column;gap:12px;margin-bottom:20px}
    .square-toolbar .input{max-width:400px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:12px;color:#374151;cursor:pointer}
    .chip.active{background:#dbeafe;color:#1e40af;border-color:#bfdbfe}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    .card{border:1px solid var(--border);border-radius:12px;background:#fff;padding:10px;display:flex;flex-direction:column;gap:8px}
    .card h4{margin:0;font-size:14px}
    .card p{margin:0;color:#6b7280;font-size:12px}
    .card .meta{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#64748b}
    .select-btn{padding:8px 10px;border:none;border-radius:10px;background:var(--accent);color:#1e3a8a;cursor:pointer;font-size:12px}
    .select-btn.selected{background:#10b981;color:#064e3b}
    .selected-bar{display:flex;gap:12px;flex-wrap:wrap;margin-top:1rem;justify-content:center;min-height:40px;max-width:750px;width:100%}
    .badge{display:inline-flex;gap:6px;align-items:center;padding:7px 16px;border-radius:999px;background:#e0f2fe;color:#0c4a6e;border:1px solid #bae6fd;font-size:13px;font-weight:500;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .badge .x{cursor:pointer;color:#0369a1;margin-left:4px;font-weight:600;opacity:0.7;transition:opacity .2s}
    .badge .x:hover{opacity:1}
    @media (max-width:1400px){
      .launch-right{padding:70px 100px}
    }
    @media (max-width:1200px){
      .launch-right{padding:60px 80px}
    }
    @media (max-width:960px){
      .launch{flex-direction:column}
      .launch-left{flex:unset;border-right:none;border-bottom:1px solid var(--border)}
      .launch-right{padding:50px 30px;width:100%}
      .logo{margin-bottom:1.2rem;gap:14px}
      .logo-badge{width:40px;height:40px;font-size:15px}
      .logo-title{font-size:22px}
      .form{max-width:100%;gap:14px;margin-bottom:0}
      .input{padding:16px 20px;font-size:15px;min-height:50px}
      .btn{padding:16px 24px;font-size:15px;min-height:50px}
      .launch .hint{font-size:14px;max-width:100%;margin-top:0.5rem;padding:0 10px}
      .selected-bar{margin-top:1rem;gap:10px;max-width:100%}
      .badge{padding:6px 14px;font-size:12px}
      .grid{grid-template-columns:1fr}
    }
    @media (max-width:480px){
      .launch-right{padding:40px 20px}
      .logo{margin-bottom:1rem;gap:12px}
      .logo-badge{width:36px;height:36px;font-size:14px}
      .logo-title{font-size:20px}
      .form{flex-direction:column;gap:12px;align-items:stretch;margin-bottom:0}
      .input{min-height:48px;padding:14px 18px;font-size:15px}
      .btn{min-height:48px;padding:14px 20px;font-size:15px}
      .launch .hint{font-size:13px;margin-top:0.5rem;padding:0 5px}
      .selected-bar{margin-top:1rem;gap:8px}
      .badge{padding:5px 12px;font-size:11px}
    }

    /* Phase 2ï¼šå·¥ä½œå° */
    .workbench{position:absolute;inset:0;padding:16px;opacity:0;transform:translateY(12px);transition:opacity .35s ease,transform .35s ease;pointer-events:none}
    .workbench.visible{opacity:1;transform:translateY(0);pointer-events:auto}
    .columns{height:100%;display:grid;grid-template-columns:1.6fr 1fr;gap:16px;transition:grid-template-columns 0.4s ease}
    .columns.single{grid-template-columns:1fr}

    .panel{background:var(--card);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.04)}
    .panel__head{padding:12px 16px 10px 16px;border-bottom:1px solid var(--border)}
    .title{margin:0;font-size:16px;font-weight:700}
    .subtitle{margin:4px 0 0 0;font-size:12px;color:var(--muted)}

    /* èŠå¤©å®¹å™¨ï¼šå°†æ¶ˆæ¯è½¨é“å±…ä¸­æ˜¾ç¤ºï¼Œä¸¤ä¾§ç•™ç™½ */
    .chat__container{
      flex:1;overflow:auto;padding:14px;scroll-behavior:smooth;
      background:radial-gradient(1000px 200px at 10% 0%, rgba(59,130,246,.05), transparent 60%),radial-gradient(800px 200px at 90% 0%, rgba(59,130,246,.05), transparent 60%);
      display:flex;flex-direction:column;align-items:center; /* å…³é”®ï¼šåœ¨é¢æ¿å†…éƒ¨å±…ä¸­ */
    }
    .panel__footer{border-top:1px solid var(--border);padding:12px;background:#fff}
    .panel__footer .form{max-width:720px;margin:0 auto;gap:8px}
    .panel__footer .input{flex:1}

    /* æ¶ˆæ¯è½¨é“æœ€å¤§å®½åº¦ï¼Œå±…ä¸­ï¼Œä¸¤ä¾§ç•™ç©º */
    .msg{display:flex;width:100%;max-width:840px;margin:8px 0;opacity:0;transform:translateY(8px);animation:fadeIn .25s ease forwards}
    .msg--user{justify-content:flex-end}
    .bubble{max-width:76%;padding:10px 12px;border-radius:14px;font-size:14px;line-height:1.5;box-shadow:0 2px 8px rgba(0,0,0,.04);white-space:pre-wrap}
    .bubble--user{background:#2563eb;color:#fff;border-top-left-radius:14px;border-bottom-left-radius:14px;border-top-right-radius:14px}
    .bubble--system{background:#f9fafb;color:#111827;border:1px solid var(--border);border-top-right-radius:14px;border-bottom-right-radius:14px;border-top-left-radius:14px}
    .small{margin-top:6px;font-size:12px;color:var(--muted)}

    .planning{border:1px dashed #bfdbfe;border-radius:12px;padding:10px;background:#eff6ff}
    .planning h4{margin:0 0 6px 0;font-size:14px}
    .planning ol{margin:8px 0 8px 18px;padding:0}
    .planning li{margin:6px 0}
    .planning .start-btn{display:inline-block;margin-top:8px;padding:8px 12px;background:var(--accent);color:#1e40af;border:none;border-radius:10px;cursor:pointer;font-size:13px;transition:filter .15s,transform .06s}
    .planning .start-btn:hover{filter:brightness(0.95)}
    .planning .start-btn:active{transform:translateY(1px)}

    /* æ–°çš„å¡ç‰‡æ ·å¼ */
    .analysis-card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .analysis-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .analysis-icon{font-size:16px}
    .analysis-title{font-weight:600;font-size:14px;color:#111827}
    .analysis-status{font-size:12px;color:#6b7280;margin-left:auto}
    .analysis-content{display:flex;flex-direction:column;gap:4px}
    .analysis-item{font-size:12px;color:#374151;padding:2px 0;line-height:1.4}

    .steps-container{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .steps-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .steps-icon{font-size:16px}
    .steps-title{font-weight:600;font-size:14px;color:#111827}
    .steps-list{display:flex;flex-direction:column;gap:6px}
    .step-item{display:flex;align-items:center;gap:8px;padding:4px 0}
    .step-circle{font-size:14px;color:#6b7280;min-width:16px;text-align:center}
    .step-title{font-size:13px;color:#374151}
    .step-running .step-title{color:#3b82f6;font-weight:500}
    .step-completed .step-title{color:#059669;font-weight:500}

    .tool-card{border:1px solid #d1d5db;border-radius:10px;padding:10px;background:#f9fafb;margin:8px 0;box-shadow:0 1px 4px rgba(0,0,0,.04)}
    .tool-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .tool-name{font-weight:600;font-size:12px;color:#1e40af}
    .tool-action{font-size:11px;color:#6b7280}
    .tool-params{margin-bottom:6px}
    .param-item{display:flex;gap:4px;font-size:11px}
    .param-key{color:#6b7280;font-weight:500}
    .param-value{color:#374151;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .tool-status{font-size:11px;color:#6b7280;text-align:right}

    .result-card{border:1px solid #10b981;border-radius:12px;padding:12px;background:#f0fdf4;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .result-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .result-icon{font-size:16px}
    .result-title{font-weight:600;font-size:14px;color:#059669}
    .result-content{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
    .result-item{font-size:13px;color:#374151;line-height:1.4}
    .result-meta{font-size:11px;color:#6b7280;text-align:right}

    /* ç®€çº¦é£æ ¼ï¼šæ€è€ƒæ°”æ³¡ä¸å†…è”é€‰æ‹© */
    .thought{position:relative;border:1px solid var(--border);border-radius:10px;background:#fff;padding:8px 10px}
    .thought-head{display:flex;align-items:center;gap:6px;margin-bottom:4px}
    .thought-icon{font-size:15px}
    .thought-title{font-weight:600;font-size:13px;color:#111827}
    .thought-body{font-size:13px;color:#374151;line-height:1.45}
    .thought-footer{display:flex;justify-content:flex-end;margin-top:4px}
    .thought-toggle{border:none;background:#f3f4f6;color:#374151;padding:5px 9px;border-radius:8px;font-size:12px;cursor:pointer}

    .inline-choice{border:1px solid var(--border);border-radius:12px;background:#fff;padding:10px 12px}
    .inline-choice-title{font-weight:600;font-size:13px;margin-bottom:8px;color:#111827}
    .inline-choice-options{display:flex;gap:8px;flex-wrap:wrap}
    .inline-choice-btn{padding:6px 12px;border:1px solid #dbeafe;border-radius:999px;background:#fff;color:#1e40af;font-size:12px;cursor:pointer}
    .inline-choice-btn.selected{background:#1e40af;color:#fff;border-color:#1e40af}

    /* ç®€çº¦é£æ ¼ï¼šæœ€å°åŒ–ç»“æœå¡ç‰‡ */
    .result-card.minimal{border:1px solid var(--border);background:#fff;box-shadow:none}
    .result-card.minimal .result-title{color:#111827}

    /* åˆ†å±‚æ–‡æœ¬è¡Œï¼ˆæ­¥éª¤å¼€å§‹/è°ƒç”¨/æ€è€ƒï¼‰ */
    .flow-line{font-size:13px;color:#111827;margin:6px 0}
    .flow-line.root{font-weight:600}
    .flow-line.indent-1{margin-left:16px;color:#374151}

    /* æ€è€ƒä¸­æ ‡ç­¾æ ·å¼ï¼ˆç”¨äºéœ€æ±‚åˆ†æä¸æ­¥éª¤é—´æ€è€ƒï¼‰ */
    .thinking-bubble .tag{position:absolute;top:-9px;left:10px;z-index:1;display:inline-block;font-size:11px;color:#475569;background:#eef2f7;border:1px solid #e5e7eb;border-radius:6px;padding:2px 6px;box-shadow:0 1px 2px rgba(0,0,0,.04)}

    @media (max-width:480px){
      .thinking-bubble .tag{top:-8px;left:8px}
      .thought{padding:8px 10px}
      .thought-body{line-height:1.5}
    }

    .rethink-card{border:1px solid #f59e0b;border-radius:12px;padding:12px;background:#fffbeb;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .rethink-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .rethink-icon{font-size:16px}
    .rethink-title{font-weight:600;font-size:14px;color:#d97706}
    .rethink-content{display:flex;flex-direction:column;gap:4px;margin-bottom:8px}
    .rethink-item{font-size:12px;color:#374151;padding:2px 0;line-height:1.4}
    .rethink-status{font-size:11px;color:#d97706;text-align:right}

    .choice-card{border:1px solid #8b5cf6;border-radius:12px;padding:12px;background:#faf5ff;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .choice-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .choice-icon{font-size:16px}
    .choice-title{font-weight:600;font-size:14px;color:#7c3aed}
    .choice-options{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    .choice-btn{padding:6px 12px;border:1px solid #c4b5fd;border-radius:8px;background:#fff;color:#7c3aed;font-size:12px;cursor:pointer;transition:all .15s}
    .choice-btn:hover{background:#f3f4f6;border-color:#a78bfa}
    .choice-btn.selected{background:#7c3aed;color:#fff;border-color:#7c3aed}
    .choice-status{font-size:11px;color:#6b7280;text-align:right}

    /* å³ä¾§å·¥ä½œå°çŠ¶æ€é¢æ¿ */
    .status-panel{padding:16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#fff,#fcfdfc)}
    .status-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .status-item:last-child{margin-bottom:0}
    .status-label{font-size:12px;color:var(--muted);font-weight:500}
    .status-value{font-size:13px;color:#111827;font-weight:600}
    .progress-container{display:flex;align-items:center;gap:8px;flex:1}
    .progress-text{font-size:11px;color:var(--muted);min-width:30px;text-align:right}

    /* å–æ¶ˆæŠ½è±¡è¿›åº¦æ¡è§†è§‰ï¼Œæ”¹ä¸ºå…·ä½“å·¥å…·è°ƒç”¨æ—¥å¿— */

    .workflow{background:var(--card);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.04);opacity:0;transform:translateX(20px);transition:opacity 0.4s ease,transform 0.4s ease}
    .workflow.visible{opacity:1;transform:translateX(0)}
    .workflow__head{padding:12px 16px 10px 16px;border-bottom:1px solid var(--border)}
    .workflow__tabs{display:flex;gap:8px;margin-top:8px}
    .workflow__tab{padding:6px 12px;border:1px solid var(--border);background:#fff;border-radius:8px;font-size:12px;color:#374151;cursor:pointer}
    .workflow__tab--active{background:#eef2ff;border-color:#c7d2fe;color:#3730a3;font-weight:600}
    .workflow__body{flex:1;display:flex;flex-direction:column;overflow:hidden}
    .tab-pane{display:none;height:100%}
    .tab-pane.active{display:block}
    .files__header{padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:#111827}
    .files__list{list-style:none;margin:0;padding:10px 16px;display:flex;flex-direction:column;gap:8px;max-height:40%;overflow:auto}
    .files__item{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:8px;padding:8px 10px;background:#fff;font-size:12px;color:#111827;cursor:pointer}
    .files__item:hover{background:#f9fafb}
    .files__preview{flex:1;border-top:1px solid var(--border);padding:12px 16px;font-size:12px;color:#374151;overflow:auto}
    .workflow__footer{border-top:1px solid var(--border);padding:10px 16px;background:#fff}
    .footer-status{display:flex;align-items:center;gap:8px;font-size:12px;color:#4b5563;margin-bottom:8px}
    .footer-label{color:#6b7280}
    .footer-value{color:#111827;font-weight:600}
    .footer-sep{color:#d1d5db}
    
    /* æ€»ä½“è¿›åº¦æ¡ï¼ˆå³ä¾§ï¼‰ä¸é˜¶æ®µè¿›åº¦æ¡ï¼ˆå·¦ä¾§é»‘ç›’ï¼‰ */
    .overall-progress{height:10px;width:100%;background:#eef2f7;border-radius:999px;overflow:hidden;margin:12px 0}
    .overall-progress__bar{height:100%;width:0%;background:linear-gradient(90deg, var(--accent), var(--progress));transition:width .2s ease}
    .phase{width:100%;max-width:840px;background:#fff;border:1px dashed #bfdbfe;border-radius:10px;padding:10px;margin:8px 0}
    .phase-title{font-size:13px;font-weight:700;color:#1f2937;margin:0 0 6px 0}
    .phase-progress{height:8px;width:100%;background:#eef2f7;border-radius:999px;overflow:hidden;margin:6px 0}
    .phase-progress__bar{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#3b82f6);transition:width .2s ease}
    
    .logs{flex:1;overflow:auto;padding:12px 14px;background:#fff}
    .log-line{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px;color:#374151;padding:4px 0;margin:2px 0;opacity:0;transform:translateY(6px);animation:fadeIn .2s ease forwards;border:none;background:transparent}
    
    /* å·¥å…·è°ƒç”¨ä¿¡æ¯ï¼šä½¿ç”¨ç®€æ´æ–‡æœ¬è¡Œï¼ˆä¸å†ä½¿ç”¨æ¡†å¼ execution-logï¼‰ */
    .log-time{color:#64748b;font-weight:500;font-size:11px;min-width:50px}
    .log-tool{color:#1e40af;font-weight:600}
    .log-params{background:transparent;border:none;border-radius:0;padding:0;margin-top:0;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:11px;color:#374151}
    .log-result{color:#059669;font-weight:600}
    .log-error{color:#dc2626;font-weight:600}

    /* å·¦ä¾§èŠå¤©åŒºçš„ç®€æ´å·¥å…·è°ƒç”¨è¡Œï¼ˆæ— æ°”æ³¡ã€æ— è¾¹æ¡†ï¼‰ */
    .plain-log{width:100%;max-width:840px;margin:4px 0;color:#1f2937;font-size:12px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;border-left:2px solid var(--accent-weak);padding-left:8px}
    

    .file-card{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;margin-top:8px;box-shadow:0 1px 4px rgba(0,0,0,.04)}
    .file-icon{width:20px;height:24px;border:1px solid var(--border);border-radius:3px;background:linear-gradient(180deg,#f3f4f6,#e5e7eb);position:relative}
    .file-icon::after{content:'';position:absolute;top:0;right:0;width:8px;height:8px;background:#fff;border-left:1px solid var(--border);border-bottom:1px solid var(--border);transform:translate(1px,1px) rotate(45deg)}

    /* è¯„åˆ†ç»„ä»¶æ ·å¼ */
    .rating{margin-top:8px;user-select:none}
    .stars{display:flex;gap:4px;font-size:20px;cursor:pointer}
    .star{filter:grayscale(1) opacity(.6); transition:filter .15s ease,transform .06s}
    .star.active{filter:none}
    .star:active{transform:translateY(1px)}

    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}

    /* å…³é”®è¿‡æ¸¡ï¼šPhase 1 â†’ Phase 2ï¼ˆè§†è§‰ï¼‰ */
    .to-workbench .launch{
      opacity:0;transform:translateY(-20px);
    }
    .to-workbench .launch .launch-left{display:none}
    .to-workbench .launch .launch-right{
      position:fixed;bottom:10px;left:50%;
      transform:translateX(-50%) translateY(0) scale(.98);
      width:min(980px,92vw);max-width:none;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.08);padding:12px;
      background:var(--card);border:1px solid var(--border);
    }
    .to-workbench .launch .logo{opacity:0;height:0;margin:0;transform:translateY(-6px)}
    .to-workbench .launch .hint{opacity:0;height:0}
    .to-workbench .launch .form .btn{border-radius:10px;padding:12px 16px}
    .to-workbench .launch .form .input{padding:12px 14px;font-size:14px}

    @media (max-width:960px){
      .columns{grid-template-columns:1fr}
      .panel__footer .form{max-width:100%}
      .msg{max-width:100%}
    }

    .hide{display:none}
    /* æ¶æ„ä¸æ•°æ®æµå¯è§†åŒ–æ¨¡æ€æ¡† */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}
    .modal.visible{display:flex}
    .modal__panel{width:min(920px,92vw);max-height:86vh;overflow:auto;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,.2)}
    .modal__head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}
    .modal__title{margin:0;font-size:15px;font-weight:700}
    .modal__close{border:none;background:#f3f4f6;color:#374151;padding:6px 10px;border-radius:8px;cursor:pointer}
    .modal__body{padding:16px}
    .arch-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .arch-card{border:1px solid var(--border);border-radius:10px;padding:12px;background:#fff}
    .arch-card h4{margin:0 0 8px 0;font-size:13px}
    .arch-list{margin:0;padding-left:18px}
    .arch-list li{margin:6px 0;font-size:13px;color:#374151}
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <!-- Phase 1ï¼šå…¨å±å¯åŠ¨ç•Œé¢ -->
    <section class="launch" id="launch">
      <!-- å·¦ä¾§ï¼šå¯¼èˆªå…¥å£ï¼ˆ15%ï¼‰ -->
      <aside class="launch-left" aria-label="å¯¼èˆªå…¥å£">
        <div class="left-header">
          <h3 class="left-title">å·¥ä½œå°</h3>
        </div>
        <div class="left-content">
          <div class="nav-buttons">
            <button class="nav-btn" id="nav-agents" data-page="agents">
              <span class="nav-icon">ğŸ¤–</span>
              <span class="nav-text">æ™ºèƒ½ä½“å¹¿åœº</span>
            </button>
            <button class="nav-btn" id="nav-plugins" data-page="plugins">
              <span class="nav-icon">ğŸ”Œ</span>
              <span class="nav-text">MCPæ’ä»¶å¹¿åœº</span>
            </button>
          </div>
        </div>
      </aside>
      <!-- å³ä¾§ï¼šä»»åŠ¡è¾“å…¥åŒºï¼ˆ80%ï¼‰ -->
      <div class="launch-right">
        <div class="logo">
          <div class="logo-badge">WA</div>
          <h1 class="logo-title">Workflow Agent</h1>
        </div>
        <form id="mainForm" class="form">
          <input id="mainInput" class="input" type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„ä»»åŠ¡..." />
          <button id="mainSend" class="btn" type="submit" aria-label="å¼€å§‹æ‰§è¡Œ">å¼€å§‹</button>
        </form>
        <div class="hint">ä¾‹å¦‚ï¼šè¯·æ”¶é›†å—æµ·èˆ†æƒ…çš„ç›¸å…³æƒ…å†µï¼Œç”Ÿæˆä¸€ä»½ç®€å•çš„æ€»ç»“ï¼Œå¹¶ç”¨ä¸€æ®µéŸ³é¢‘å†…å®¹æ’­æŠ¥è¿™æ®µæ€»ç»“å†…å®¹</div>
        <div id="selectionBar" class="selected-bar" aria-live="polite"></div>
      </div>
    </section>

    <!-- æ™ºèƒ½ä½“å¹¿åœºé¡µé¢ -->
    <section class="square-page hide" id="agents-page">
      <div class="square-header">
        <button class="back-btn" id="back-to-home">â† è¿”å›é¦–é¡µ</button>
        <h2 class="square-title">æ™ºèƒ½ä½“å¹¿åœº</h2>
      </div>
      <div class="square-content">
        <div class="square-toolbar">
          <input id="agentSearchSquare" class="input" placeholder="æœç´¢æ™ºèƒ½ä½“..." />
          <div id="agentChipsSquare" class="chips" aria-label="åˆ†ç±»ç­›é€‰"></div>
        </div>
        <div id="agentGridSquare" class="grid" aria-live="polite"></div>
      </div>
    </section>

    <!-- æ’ä»¶å¹¿åœºé¡µé¢ -->
    <section class="square-page hide" id="plugins-page">
      <div class="square-header">
        <button class="back-btn" id="back-to-home-plugins">â† è¿”å›é¦–é¡µ</button>
        <h2 class="square-title">MCPæ’ä»¶å¹¿åœº</h2>
      </div>
      <div class="square-content">
        <div class="square-toolbar">
          <input id="pluginSearchSquare" class="input" placeholder="æœç´¢æ’ä»¶..." />
          <div id="pluginChipsSquare" class="chips" aria-label="åˆ†ç±»ç­›é€‰"></div>
        </div>
        <div id="pluginGridSquare" class="grid" aria-live="polite"></div>
      </div>
    </section>

    <!-- Phase 2ï¼šå·¥ä½œå° -->
    <section class="workbench" id="workbench" aria-label="Workbench">
      <div class="columns single" id="columns">
        <!-- å·¦ä¾§ï¼šå¯¹è¯å†å²ï¼ˆæ¶ˆæ¯è½¨é“åœ¨é¢æ¿å†…éƒ¨å±…ä¸­ï¼‰ -->
        <div class="panel">
          <div class="panel__head">
            <h2 class="title">å¯¹è¯å†å²</h2>
            <p class="subtitle">ç³»ç»Ÿä¸ç”¨æˆ·æ¶ˆæ¯</p>
          </div>
          <div id="chatContainer" class="chat__container"></div>
          <div class="panel__footer" id="panelFooter"></div>
        </div>

        <!-- å³ä¾§ï¼šå·¥ä½œçŠ¶æ€å’Œæ—¥å¿—ï¼ˆå¸¦æ ‡ç­¾ä¸åº•éƒ¨çŠ¶æ€ï¼‰ -->
        <div class="workflow hide" id="workflowPanel">
          <div class="workflow__head">
            <h2 class="title" style="font-size:16px">å·¥ä½œå°</h2>
            <div class="workflow__tabs" id="workflowTabs">
              <button class="workflow__tab workflow__tab--active" data-tab="follow">å®æ—¶è·Ÿéš</button>
              <button class="workflow__tab" data-tab="files">æ–‡ä»¶</button>
            </div>
          </div>
          <div class="workflow__body">
            <div class="tab-pane follow-pane active" id="tab-follow">
              <div class="logs" id="logs">
                <div class="log-line">æç¤ºï¼šå½“ä»»åŠ¡å¼€å§‹åï¼Œè¿™é‡Œå°†å±•ç¤ºè¯¦ç»†æ‰§è¡Œæ—¥å¿—ã€‚</div>
              </div>
            </div>
            <div class="tab-pane files-pane" id="tab-files">
              <div class="files__header">äº§ç”Ÿçš„æ–‡ä»¶</div>
              <ul class="files__list" id="filesList"></ul>
              <div class="files__preview" id="filePreview">é€‰æ‹©æ–‡ä»¶ä»¥æŸ¥çœ‹è¯¦æƒ…</div>
            </div>
          </div>
          <div class="workflow__footer">
            <div class="footer-status">
              <span class="footer-label">çŠ¶æ€</span>
              <span class="footer-value" id="currentStatus">ç­‰å¾…ä¸­</span>
              <span class="footer-sep">|</span>
              <span class="footer-label">é˜¶æ®µ</span>
              <span class="footer-value" id="currentPhase">-</span>
              <span class="footer-sep">|</span>
              <span class="footer-label">è¿›åº¦</span>
              <span class="footer-value" id="progressText">0%</span>
            </div>
            <div class="overall-progress"><div class="overall-progress__bar" id="overallBar"></div></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const stage = document.getElementById('stage');
      const launch = document.getElementById('launch');
      const workbench = document.getElementById('workbench');
      const columns = document.getElementById('columns');
      const workflowPanel = document.getElementById('workflowPanel');
      
      // é¡µé¢è·¯ç”±ç›¸å…³
      const agentsPage = document.getElementById('agents-page');
      const pluginsPage = document.getElementById('plugins-page');
      const navAgents = document.getElementById('nav-agents');
      const navPlugins = document.getElementById('nav-plugins');
      const backToHome = document.getElementById('back-to-home');
      const backToHomePlugins = document.getElementById('back-to-home-plugins');

      const mainForm = document.getElementById('mainForm');
      const mainInput = document.getElementById('mainInput');
      const mainSend = document.getElementById('mainSend');
      // å¹¿åœºé¡µé¢å…ƒç´ 
      const selectionBar = document.getElementById('selectionBar');
      const agentSearchSquare = document.getElementById('agentSearchSquare');
      const agentChipsSquare = document.getElementById('agentChipsSquare');
      const agentGridSquare = document.getElementById('agentGridSquare');
      const pluginSearchSquare = document.getElementById('pluginSearchSquare');
      const pluginChipsSquare = document.getElementById('pluginChipsSquare');
      const pluginGridSquare = document.getElementById('pluginGridSquare');
      // è¾“å…¥æ¡† hover æç¤ºé¢„è®¾æ–‡æ¡ˆ
      const presetText = 'è¯·æ”¶é›†å—æµ·èˆ†æƒ…çš„ç›¸å…³æƒ…å†µï¼Œç”Ÿæˆä¸€ä»½ç®€å•çš„æ€»ç»“ï¼Œå¹¶ç”¨ä¸€æ®µéŸ³é¢‘å†…å®¹æ’­æŠ¥è¿™æ®µæ€»ç»“å†…å®¹';


      const chatContainer = document.getElementById('chatContainer');
      const panelFooter = document.getElementById('panelFooter');

      const logs = document.getElementById('logs');
      const currentStatus = document.getElementById('currentStatus');
      const currentPhase = document.getElementById('currentPhase');
      const progressText = document.getElementById('progressText');
      const tabsRoot = document.getElementById('workflowTabs');
      const tabFollow = document.getElementById('tab-follow');
      const tabFiles = document.getElementById('tab-files');
      const filesList = document.getElementById('filesList');
      const filePreview = document.getElementById('filePreview');
      // æ— éšœç¢ï¼šåŠ¨æ€å†…å®¹åŒºåŸŸæ’­æŠ¥
      chatContainer.setAttribute('aria-live','polite');
      logs.setAttribute('aria-live','polite');

      let isBusy = false;
      let transitioned = false;
      let currentPage = 'home';

      // é¡µé¢è·¯ç”±åŠŸèƒ½
      function showPage(pageName) {
        // éšè—æ‰€æœ‰é¡µé¢
        launch.classList.add('hide');
        agentsPage.classList.add('hide');
        pluginsPage.classList.add('hide');
        
        // æ˜¾ç¤ºç›®æ ‡é¡µé¢
        if (pageName === 'home') {
          launch.classList.remove('hide');
        } else if (pageName === 'agents') {
          agentsPage.classList.remove('hide');
          agentsPage.classList.add('visible');
        } else if (pageName === 'plugins') {
          pluginsPage.classList.remove('hide');
          pluginsPage.classList.add('visible');
        }
        
        currentPage = pageName;
      }

      // å¯¼èˆªæŒ‰é’®äº‹ä»¶
      navAgents.addEventListener('click', () => showPage('agents'));
      navPlugins.addEventListener('click', () => showPage('plugins'));
      backToHome.addEventListener('click', () => showPage('home'));
      backToHomePlugins.addEventListener('click', () => showPage('home'));

      function scrollChat(){ chatContainer.scrollTop = chatContainer.scrollHeight; }
      function scrollLogs(){ logs.scrollTop = logs.scrollHeight; }
      function setBusy(b){ isBusy = b; mainInput.disabled = b; mainSend.disabled = b; }
      
      function updateStatus(status, phase = null) {
        currentStatus.textContent = status;
        if (phase) currentPhase.textContent = phase;
      }
      
      function updateProgress(percent) {
        progressText.textContent = Math.round(percent) + '%';
      }

      // å³ä¾§é¢æ¿æ ‡ç­¾åˆ‡æ¢
      function initTabs(){
        if(!tabsRoot) return;
        tabsRoot.addEventListener('click', (e)=>{
          const btn = e.target.closest('.workflow__tab');
          if(!btn) return;
          const name = btn.getAttribute('data-tab');
          tabsRoot.querySelectorAll('.workflow__tab').forEach(b=>b.classList.remove('workflow__tab--active'));
          btn.classList.add('workflow__tab--active');
          tabFollow.classList.toggle('active', name==='follow');
          tabFiles.classList.toggle('active', name==='files');
        });
      }
      initTabs();

      // æ–‡ä»¶åˆ—è¡¨åŠ¨æ€æ›´æ–°
      const producedFiles = [];
      function addFileRecord(name, content){
        const record = { name, content, time: new Date().toLocaleTimeString('zh-CN', {hour12:false}) };
        producedFiles.push(record);
        renderFiles();
      }
      function renderFiles(){
        if(!filesList) return;
        filesList.innerHTML = '';
        producedFiles.forEach((f, idx)=>{
          const li = document.createElement('li');
          li.className = 'files__item';
          li.innerHTML = `<span>${f.name}</span><span style="color:#6b7280">${f.time}</span>`;
          li.addEventListener('click', ()=>{
            if(filePreview) filePreview.textContent = f.content || 'æš‚æ— é¢„è§ˆå†…å®¹';
          });
          filesList.appendChild(li);
        });
      }

      function addMessage({ role = 'system', html = '' }){
        const msg = document.createElement('div');
        msg.className = 'msg ' + (role === 'user' ? 'msg--user' : '');
        const bubble = document.createElement('div');
        bubble.className = 'bubble ' + (role === 'user' ? 'bubble--user' : 'bubble--system');
        if(role === 'user'){
          bubble.textContent = html; // XSS é˜²æŠ¤ï¼šç”¨æˆ·å†…å®¹ç”¨æ–‡æœ¬
        }else{
          bubble.innerHTML = html;
        }
        msg.appendChild(bubble);
        chatContainer.appendChild(msg);
        scrollChat();
        return { msg, bubble };
      }
      async function typeText(el, text, speed = 30){
        return new Promise(resolve=>{
          let i = 0;
          const timer = setInterval(()=>{
            if(i < text.length){
              el.textContent += text[i++];
              scrollChat();
            }else{ clearInterval(timer); resolve(); }
          }, speed);
        });
      }
      async function addTypedMessage({ role = 'system', prefixHtml = '', text = '', speed = 30 }){
        const { bubble } = addMessage({ role, html: `${prefixHtml}<span class="typewriter-text"></span>` });
        const el = bubble.querySelector('.typewriter-text');
        await typeText(el, text, speed);
        return bubble;
      }
      function addFlowLine(text, level = 0, strong = false){
        const line = document.createElement('div');
        line.className = 'flow-line ' + (level>0?`indent-${level}`:'root');
        line.innerHTML = strong ? `<span>â€¢ ${text}</span>` : text;
        chatContainer.appendChild(line);
        scrollChat();
        return line;
      }
      function updateBubble(bubble, html){ bubble.innerHTML = html; scrollChat(); }

      function appendLog(text, type = 'info'){
        const line = document.createElement('div');
        line.className = 'log-line';
        
        const timestamp = new Date().toLocaleTimeString('zh-CN', {hour12: false});
        const typeIcon = {
          'info': 'â€¢',
          'success': 'âœ“',
          'warning': '!',
          'error': 'âœ—',
          'debug': '?'
        }[type] || 'â€¢';
        
        line.innerHTML = `<span style="color:#6b7280;margin-right:8px">[${timestamp}]</span><span style="margin-right:8px">${typeIcon}</span>${text}`;
        logs.appendChild(line);
        scrollLogs();
      }
      
      function appendDetailedLog(agent, action, details, status = 'info'){
        const timestamp = new Date().toLocaleTimeString('zh-CN', {hour12: false});
        const line = document.createElement('div');
        line.className = 'log-line';
        
        const statusIcon = {
          'start': 'â–¶',
          'running': 'â—',
          'success': 'âœ“',
          'error': 'âœ—',
          'debug': '?'
        }[status] || 'â€¢';
        
        line.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
            <span style="color:#6b7280">[${timestamp}] ${statusIcon}</span>
            <span style="color:#1e40af;font-weight:600">${agent}</span>
          </div>
          <div style="color:#374151;margin-bottom:2px">${action}</div>
          <div style="color:#6b7280;font-size:11px">${details}</div>
        `;
        logs.appendChild(line);
        scrollLogs();
      }
      
      // å·¥å…·è°ƒç”¨æ—¥å¿—
      function addExecutionLog(stepIndex, toolName, action, type = 'start', params = null, result = null){
        const time = new Date().toLocaleTimeString('zh-CN', {hour12: false});
        const parts = [];
        if(type === 'start'){
          parts.push(`å¼€å§‹æ‰§è¡Œæ­¥éª¤${stepIndex + 1}: [${toolName}] - ${action}`);
        }else if(type === 'running'){
          parts.push(`æ‰§è¡Œä¸­ æ­¥éª¤${stepIndex + 1}: [${toolName}] - ${action}`);
        }else if(type === 'completed'){
          parts.push(`æ­¥éª¤${stepIndex + 1}å®Œæˆ: [${toolName}] è¿”å› ${result ?? 'æˆåŠŸ'}`);
        }else if(type === 'failed'){
          parts.push(`æ­¥éª¤${stepIndex + 1}å¤±è´¥: [${toolName}] - ${action}`);
        }
        if(params){
          parts.push(`<span class="log-params">è°ƒç”¨[${toolName}] å‚æ•°: ${JSON.stringify(params)}</span>`);
        }
        const line = document.createElement('div');
        line.className = 'plain-log';
        line.setAttribute('data-type', type);
        line.innerHTML = `<span class="log-time">[${time}]</span> ${parts.join('<br/>')}`;
        chatContainer.appendChild(line);
        scrollChat();
        
      }
      
      // æŠ½è±¡è¿›åº¦æ¡å·²ç§»é™¤ï¼Œç»Ÿä¸€ç”¨å…·ä½“å·¥å…·è°ƒç”¨æ—¥å¿—æ›¿ä»£


      async function showPlanningAndBindStart(){
        // 1) éœ€æ±‚åˆ†æï¼šç®€çº¦æ°”æ³¡ + å·¦ä¸Šè§’â€œæ€è€ƒä¸­...â€æ ‡ç­¾ + æ‰“å­—æœº
        const analysisText = "åˆ†æç”¨æˆ·éœ€æ±‚ï¼šéœ€è¦æ”¶é›†å—æµ·åœ°åŒºæœ€æ–°èˆ†æƒ…åŠ¨æ€å¹¶ç”Ÿæˆæ€»ç»“æŠ¥å‘Šå’ŒéŸ³é¢‘æ’­æŠ¥ã€‚é¦–å…ˆéœ€è¦è·å–å—æµ·ç›¸å…³çš„æœ€æ–°æ–°é—»ã€çƒ­ç‚¹äº‹ä»¶å’Œèˆ†æƒ…æ•°æ®ï¼Œç„¶åå¯¹ä¿¡æ¯è¿›è¡Œç­›é€‰åˆ†ç±»å’Œå…³é”®ç‚¹æå–ã€‚è€ƒè™‘åˆ°éŸ³é¢‘æ’­æŠ¥éœ€æ±‚ï¼Œéœ€è¦å°†æ€»ç»“å†…å®¹ç»“æ„åŒ–ï¼Œåˆ†ä¸ºèˆ†æƒ…æ¦‚è¿°ã€çƒ­ç‚¹åˆ†æã€è¶‹åŠ¿é¢„æµ‹ç­‰éƒ¨åˆ†ã€‚éœ€è¦ç¡®ä¿ä¿¡æ¯æ¥æºæƒå¨å‡†ç¡®ï¼Œæœ€åç”Ÿæˆç®€æ´æ˜äº†çš„æ€»ç»“æŠ¥å‘Šå¹¶è½¬æ¢ä¸ºè¯­éŸ³æ ¼å¼ã€‚";

        const thinkHtml = `
          <div class="thought thinking-bubble">
            <div class="tag">æ€è€ƒä¸­...</div>
            <div class="thought-body" data-collapsed="true" style="max-height:120px;overflow:hidden">
              <span class="typewriter-text"></span>
            </div>
            <div class="thought-footer"><button class="thought-toggle" type="button">å±•å¼€</button></div>
          </div>`;
        const { bubble } = addMessage({ role:'system', html: thinkHtml });
        const toggle = bubble.querySelector('.thought-toggle');
        const body = bubble.querySelector('.thought-body');
        const typewriterEl = bubble.querySelector('.typewriter-text');
        
        // æ‰“å­—æœºæ•ˆæœï¼ˆç­‰å¾…å…¶å®Œæˆåå†è¿›å…¥æ‰§è¡Œé˜¶æ®µï¼‰
        const typingDone = typeText(typewriterEl, analysisText, 30);
        await typingDone;
        toggle.style.display = 'block';
        
        toggle.addEventListener('click', ()=>{
          const collapsed = body.getAttribute('data-collapsed') === 'true';
          if(collapsed){ body.style.maxHeight = 'none'; toggle.textContent = 'æ”¶èµ·'; }
          else { body.style.maxHeight = '120px'; toggle.textContent = 'å±•å¼€'; }
          body.setAttribute('data-collapsed', (!collapsed).toString());
        });

        // 2) è‡ªåŠ¨å¼€å§‹æ‰§è¡Œï¼ˆä¸¥æ ¼é¡ºåºï¼šåœ¨éœ€æ±‚åˆ†æå®Œå…¨æ˜¾ç¤ºåï¼‰
        // ä¿æŒ busy çŠ¶æ€ä»¥é˜»æ­¢ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤
        setBusy(true);
          updateStatus('éœ€æ±‚åˆ†æä¸­', 'åˆ†æé˜¶æ®µ'); updateProgress(5);
          appendDetailedLog('System', 'éœ€æ±‚åˆ†æ', 'å®Œæˆéœ€æ±‚åˆ†æï¼Œå‡†å¤‡æ‰§è¡Œ', 'success');

          // å®šä¹‰ç²¾ç®€å·¥å…·è°ƒç”¨æµç¨‹ï¼ˆæ— å¤æ‚å‚æ•°å±•ç¤ºï¼‰
          const calls = [
            { tool:'Serper API', action:'æ£€ç´¢å—æµ·ç›¸å…³æ–°é—»ä¸èˆ†æƒ…æ•°æ®' },
            { tool:'Text Analysis', action:'å¯¹ä¿¡æ¯è¿›è¡Œèšç±»ä¸å…³é”®ç‚¹æå–' },
            { tool:'Report Generator', action:'ç”Ÿæˆç»“æ„åŒ–æ€»ç»“æŠ¥å‘Š' },
            { tool:'TTS Engine', action:'å°†æ€»ç»“å†…å®¹è½¬æ¢ä¸ºè¯­éŸ³æ’­æŠ¥', decision:true }
          ];

          const overallBar = document.getElementById('overallBar');

          for(let i=0;i<calls.length;i++){
            const c = calls[i];

            // åœ¨ç¬¬ä¸€ä¸ªå·¥å…·è°ƒç”¨å¼€å§‹æ—¶ï¼Œå±•å¼€å³ä¾§é¢æ¿ä¸åŒæ å¸ƒå±€
            if(i===0){
              // å±•å¼€å·¥ä½œå°å¸ƒå±€
              columns.classList.remove('single');
              // æ˜¾ç¤ºå³ä¾§é¢æ¿å¹¶æ·»åŠ åŠ¨ç”»
              workflowPanel.classList.remove('hide');
              setTimeout(() => {
                workflowPanel.classList.add('visible');
              }, 100);
            }

            // æ­¥éª¤å¼€å§‹ï¼ˆæ ¹çº§åˆ«ï¼Œé»‘ç‚¹å¼ºè°ƒï¼Œç³»ç»Ÿæ°”æ³¡é€å­—ï¼‰
            const stepTitles = [
              'â€¢ ç°åœ¨å¼€å§‹æ”¶é›†å—æµ·èˆ†æƒ…çš„ç›¸å…³èµ„æ–™...',
              'â€¢ å¼€å§‹åˆ†æèˆ†æƒ…æ•°æ®å¹¶æå–å…³é”®ç‚¹...',
              'â€¢ å¼€å§‹ç”Ÿæˆç»“æ„åŒ–æ€»ç»“æŠ¥å‘Š...',
              'â€¢ å¼€å§‹ç”ŸæˆéŸ³é¢‘æ’­æŠ¥å†…å®¹...'
            ];
            await addTypedMessage({ role: 'system', prefixHtml: '', text: stepTitles[i], speed: 24 });
            updateStatus('æ‰§è¡Œä¸­', c.action);

            // æ­¥éª¤å†…æ“ä½œï¼ˆç³»ç»Ÿæ°”æ³¡é€å­—ï¼‰
            await addTypedMessage({ role: 'system', prefixHtml: '', text: `è°ƒç”¨${c.tool}ï¼Œ${c.action}`, speed: 26 });
            appendLog(`è°ƒç”¨ ${c.tool}ï¼š${c.action}`, 'info');

            // æ­¥éª¤å†…æ€è€ƒï¼ˆç³»ç»Ÿæ°”æ³¡é€å­—ï¼‰
            const stepThoughts = [
              'åŸºäºæœç´¢ç»“æœï¼Œå‘ç°éœ€è¦è°ƒæ•´å…³é”®è¯è¦†ç›–æ›´å¤šç»´åº¦',
              'åŸºäºèšç±»åˆ†æç»“æœï¼Œè¯†åˆ«å‡ºä¸»è¦è§‚ç‚¹å’Œè¶‹åŠ¿',
              'åŸºäºåˆ†æç»“æœï¼Œæ„å»ºç»“æ„åŒ–çš„æŠ¥å‘Šæ¡†æ¶',
              'åŸºäºæŠ¥å‘Šå†…å®¹ï¼Œå‡†å¤‡è¯­éŸ³æ’­æŠ¥å‚æ•°'
            ];
            await addTypedMessage({ role: 'system', prefixHtml: '', text: stepThoughts[i], speed: 26 });

            // å¦‚éœ€ç”¨æˆ·å†³ç­–ï¼Œåˆ™åœ¨è°ƒç”¨å‰æ’å…¥å¯¹è¯å†…é€‰æ‹©
            if(c.decision){
              const choiceHtml = `
                <div class="inline-choice">
                  <div class="inline-choice-title">è¯·é€‰æ‹©æ’­æŠ¥é£æ ¼</div>
                  <div class="inline-choice-options">
                    <button class="inline-choice-btn" data-voice="kanghui">åº·è¾‰</button>
                    <button class="inline-choice-btn" data-voice="dongxuan">è‘£ç’‡</button>
                    <button class="inline-choice-btn" data-voice="trump">ç‰¹æœ—æ™®</button>
                  </div>
                  <div class="inline-choice-status small">ç­‰å¾…æ‚¨çš„é€‰æ‹©...</div>
                </div>
              `;
              const { bubble: choiceBubble } = addMessage({ role:'system', html: choiceHtml });
              await new Promise(resolve=>{
                choiceBubble.querySelectorAll('.inline-choice-btn').forEach(btn=>{
                  btn.addEventListener('click', ()=>{
                    choiceBubble.querySelectorAll('.inline-choice-btn').forEach(b=>b.classList.remove('selected'));
                    btn.classList.add('selected');
                    const st = choiceBubble.querySelector('.inline-choice-status');
                    st.textContent = `å·²é€‰æ‹©ï¼š${btn.textContent}`;
                    st.style.color = '#059669';
                    appendLog(`ç”¨æˆ·é€‰æ‹©è¯­éŸ³é£æ ¼ï¼š${btn.textContent}`, 'success');
                  resolve(); 
                  });
                });
              });
            }

            // æ¨¡æ‹Ÿå·¥å…·æ‰§è¡Œè¿›åº¦ï¼ˆç®€åŒ–ï¼‰
            await new Promise(resolve=>{
              const total = 1200 + Math.random()*800; const start = Date.now();
              const t = setInterval(()=>{
                const p = Math.min(100, Math.round((Date.now()-start)/total*100));
                const overall = Math.round(((i + p/100)/calls.length)*100);
                overallBar.style.width = overall + '%'; updateProgress(overall);
                if(p>=100){ clearInterval(t); resolve(); }
              }, 100);
            });

            appendLog(`å®Œæˆï¼š${c.tool} - ${c.action}`, 'success');
            // æ­¥éª¤é—´æ€è€ƒï¼ˆç®€çº¦æ€è€ƒæ°”æ³¡ + æ‰“å­—æœºï¼‰
            const betweenThoughts = [
              'åŸºäºèˆ†æƒ…æ•°æ®æ”¶é›†ç»“æœï¼Œä¸‹ä¸€æ­¥éœ€è¦è¿›è¡Œä¿¡æ¯èšç±»åˆ†æ',
              'åŸºäºèšç±»åˆ†æç»“æœï¼Œä¸‹ä¸€æ­¥éœ€è¦ç”Ÿæˆç»“æ„åŒ–æ€»ç»“æŠ¥å‘Š',
              'æ€»ç»“æŠ¥å‘Šå·²ç”Ÿæˆï¼Œä¸‹ä¸€æ­¥å°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºè¯­éŸ³æ’­æŠ¥'
            ];
            if(i < betweenThoughts.length){
              const bt = `\n          <div class=\"thought thinking-bubble\">\n            <div class=\"tag\">æ€è€ƒä¸­...</div>\n            <div class=\"thought-body\"><span class=\"typewriter-text\"></span></div>\n          </div>`;
              const { bubble: btBubble } = addMessage({ role:'system', html: bt });
              const el = btBubble.querySelector('.typewriter-text');
              await typeText(el, betweenThoughts[i], 26);
            }
          }

          // ç»“æœè¾“å‡ºï¼šå…ˆç®€æ´æ€»ç»“ï¼Œå†ç®€æ´ç»“æœå¡ç‰‡
          updateStatus('ä»»åŠ¡å®Œæˆ', 'å…¨éƒ¨å®Œæˆ'); updateProgress(100);
          addMessage({ role:'system', html: 'ä»»åŠ¡å®Œæˆï¼šå·²ç”Ÿæˆèˆ†æƒ…æ€»ç»“ä¸éŸ³é¢‘æ’­æŠ¥ã€‚' });
          addMessage({ role:'system', html: `
            <div class="result-card minimal">
              <div class="result-header">
                <span class="result-title">ç»“æœ</span>
                </div>
              <div class="result-content">
                <div class="result-item">èˆ†æƒ…æ€»ç»“ï¼šå—æµ·çƒ­ç‚¹é›†ä¸­åœ¨èµ„æºå¼€å‘äº‰è®®ä¸åœ°åŒºåšå¼ˆã€‚</div>
                <div class="result-item">éŸ³é¢‘æ’­æŠ¥ï¼š<a href="#" style="color:#2563eb;text-decoration:none">ç‚¹å‡»æ’­æ”¾</a>ï¼ˆçº¦2åˆ†30ç§’ï¼‰</div>
                </div>
              <div class="result-meta">${new Date().toLocaleString('zh-CN')}</div>
              </div>
          `});

          setBusy(false);
        
      }

      // æ­¥éª¤é—´æ€è€ƒï¼šåŸºäºä¸Šä¸€æ­¥ç»“æœå†³å®šä¸‹ä¸€æ­¥
      function continueThinking(prevCall, index, total){
        const texts = [
          'åŸºäºèˆ†æƒ…æ•°æ®åˆ†æï¼Œä¸‹ä¸€æ­¥éœ€è¦ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š',
          'åŸºäºèšç±»åˆ†æç»“æœï¼Œä¸‹ä¸€æ­¥éœ€è¦ç”Ÿæˆç»“æ„åŒ–æ€»ç»“æŠ¥å‘Š',
          'æ€»ç»“æŠ¥å‘Šå·²ç”Ÿæˆï¼Œä¸‹ä¸€æ­¥å°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºè¯­éŸ³æ’­æŠ¥',
          'éŸ³é¢‘ç”Ÿæˆå®Œæˆï¼Œå‡†å¤‡è¾“å‡ºæœ€ç»ˆç»“æœ'
        ];
        const content = texts[Math.min(index, texts.length-1)];
        // æ­¥éª¤é—´è¿‡æ¸¡æ€è€ƒï¼šä¸æ­¥éª¤å¼€å§‹åŒçº§ï¼ˆä¸ç¼©è¿›ï¼‰
        addFlowLine(content, 0, false);
      }

      function dockFormIntoPanel(){
        // è¿ç§»é€‰æ‹©å¾½ç« åˆ°å·¥ä½œå°è¾“å…¥åŒºä¸Šæ–¹
        const container = document.createElement('div');
        container.className = 'selected-bar';
        container.id = 'selectionBarDocked';
        panelFooter.innerHTML = '';
        panelFooter.appendChild(container);
        panelFooter.appendChild(mainForm);
        launch.classList.add('hide');
        // åŒæ­¥å¾½ç« 
        function syncDocked(){
          container.innerHTML = selectionBar.innerHTML;
          container.querySelectorAll('.x').forEach(x=>{
            x.addEventListener('click', ()=>{
              const type = x.getAttribute('data-type');
              const id = x.getAttribute('data-id');
              if(type==='agent') selected.agents.delete(id); else selected.plugins.delete(id);
              // é‡æ¸²æŸ“ä¸¤ç«¯
              const evt = new Event('sync');
              selectionBar.dispatchEvent(evt);
            });
          });
        }
        selectionBar.addEventListener('sync', ()=>{
          renderBadges();
          renderAgentGrid();
          renderPluginGrid();
          syncDocked();
        });
        // é¦–æ¬¡åŒæ­¥
        syncDocked();
      }

      function startTransition(){
        if(transitioned) {
          // å¦‚æœå·²ç»è·³è½¬è¿‡ï¼Œç¡®ä¿å·¥ä½œå°å¯è§
          workbench.classList.add('visible');
          return;
        }
        transitioned = true;
        document.body.classList.add('to-workbench');
        setTimeout(()=>{
          workbench.classList.add('visible');
          dockFormIntoPanel();
          mainInput && mainInput.focus();
        }, 150);
      }

      function handleUserInput(text){
        const trimmed = text.trim();
        if(!trimmed) return;

        // ä¿®æ­£ï¼šæ”¹ä¸ºè¯†åˆ«å—æµ·å’Œè§†é¢‘ç›¸å…³å…³é”®è¯
        const lower = trimmed.toLowerCase();
        const hasSouthChinaSea = lower.includes('å—æµ·') || lower.includes('south china sea') || lower.includes('å—ä¸­å›½æµ·');
        const hasVideo = lower.includes('è§†é¢‘') || lower.includes('video') || lower.includes('è„šæœ¬') || lower.includes('æ€»ç»“');

        if(!(hasSouthChinaSea && hasVideo)){
          addMessage({ role:'system', html:'æ‚¨å¥½ï¼ç°åœ¨æä¾›ä¸‰ç§å…¥å£ï¼šåœ¨"ä»»åŠ¡"é¡µç›´æ¥è¾“å…¥ï¼Œæˆ–å…ˆåˆ°"æ™ºèƒ½ä½“å¹¿åœº / MCP æ’ä»¶å¹¿åœº"æµè§ˆå¹¶é€‰æ‹©åå†è¾“å…¥ã€‚æ¼”ç¤ºä»»åŠ¡å»ºè®®åŒ…å«"å—æµ·"å’Œ"æ€»ç»“"ã€‚' });
          return;
        }

        startTransition();

        // æ–°é¡ºåºï¼šå…ˆæ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯ï¼ˆå³ä¾§æ°”æ³¡ï¼‰ï¼Œå†æ˜¾ç¤ºç³»ç»Ÿç¡®è®¤ï¼ˆå·¦ä¾§æ°”æ³¡ï¼‰
        addMessage({ role:'user', html: trimmed });
        addMessage({ role:'system', html:'å·²ç»æ”¶åˆ°ä½ çš„ä»»åŠ¡ï¼Œå³å°†å¼€å§‹åˆ†æ' });
        
        appendLog('æ”¶åˆ°æ–°ä»»åŠ¡ï¼šå¼€å§‹éœ€æ±‚åˆ†æ', 'info');
        appendDetailedLog('System', 'ä»»åŠ¡æ¥æ”¶', 'ç”¨æˆ·è¾“å…¥å·²æ¥æ”¶ï¼Œå¼€å§‹éœ€æ±‚åˆ†æ', 'start');

        // 2. å»¶è¿Ÿåå¼€å§‹æ˜¾ç¤ºéœ€æ±‚åˆ†æï¼ˆä¸åœ¨æ­¤å¤„è§£é™¤å¿™ç¢Œï¼›äº¤ç»™åˆ†æå®Œæˆåå¤„ç†ï¼‰
        setBusy(true);
        setTimeout(()=>{ showPlanningAndBindStart(); }, 1500);
      }

      mainForm.addEventListener('submit', (e)=>{
        e.preventDefault();
        if(isBusy) return;
        const v = mainInput.value;
        handleUserInput(v);
        // åœ¨æ¥å—ä»»åŠ¡åå†æ¸…ç©ºè¾“å…¥æ¡†
        const lower = v.toLowerCase();
        const ok = (lower.includes('å—æµ·') || lower.includes('south china sea') || lower.includes('å—ä¸­å›½æµ·')) && (lower.includes('è§†é¢‘') || lower.includes('video') || lower.includes('è„šæœ¬') || lower.includes('æ€»ç»“'));
        if(ok){ mainInput.value = ''; }
      });

      // ====== å¯åŠ¨é¡µå·¦ä¾§æ ‡ç­¾åˆ‡æ¢ ======
      function switchTab(name){
        tabs.forEach(t=>{
          const active = t.dataset.tab === name;
          t.classList.toggle('tab--active', active);
          t.setAttribute('aria-selected', active ? 'true' : 'false');
        });
        Object.entries(panels).forEach(([key, el])=>{
          el.classList.toggle('active', key === name);
        });
      }
      tabs.forEach(t=>{
        t.addEventListener('click', ()=> switchTab(t.dataset.tab));
      });

      // ====== æ•°æ®ï¼šæ™ºèƒ½ä½“ä¸æ’ä»¶ ======
      const agentCatalog = [
        { id:'agent-da', name:'æ•°æ®åˆ†æåŠ©æ‰‹', desc:'è¡¨æ ¼/å¯è§†åŒ–/æ¢ç´¢æ€§åˆ†æ', category:'æ•°æ®åˆ†æ' },
        { id:'agent-cc', name:'å†…å®¹åˆ›ä½œåŠ©æ‰‹', desc:'å†™ä½œ/æ”¹å†™/æ€»ç»“', category:'å†…å®¹åˆ›ä½œ' },
        { id:'agent-code', name:'ä»£ç åŠ©æ‰‹', desc:'ä»£ç è¡¥å…¨/è°ƒè¯•/é‡æ„', category:'å¼€å‘å·¥å…·' },
        { id:'agent-research', name:'æ£€ç´¢ç ”ç©¶å‘˜', desc:'èµ„æ–™æ£€ç´¢/å¼•ç”¨ç®¡ç†', category:'ç ”ç©¶' },
        { id:'agent-audio', name:'éŸ³é¢‘åˆ¶ä½œ', desc:'TTS/é…éŸ³/å‰ªè¾‘å»ºè®®', category:'å¤šåª’ä½“' },
        { id:'agent-video', name:'è§†é¢‘è„šæœ¬åŠ©æ‰‹', desc:'è„šæœ¬/åˆ†é•œ/æ—ç™½', category:'å¤šåª’ä½“' }
      ];
      const pluginCatalog = [
        { id:'plg-serper', name:'Serper æœç´¢', desc:'è°·æ­Œæœç´¢ API', category:'æœç´¢å¼•æ“' },
        { id:'plg-openapi', name:'OpenAPI è¿æ¥å™¨', desc:'å¯¹æ¥ä»»æ„ OpenAPI', category:'API è¿æ¥å™¨' },
        { id:'plg-csv', name:'CSV å¤„ç†å™¨', desc:'è§£æ/ç­›é€‰/ç»Ÿè®¡', category:'æ•°æ®å¤„ç†' },
        { id:'plg-db', name:'æ•°æ®åº“è¿æ¥å™¨', desc:'æŸ¥è¯¢ä¸å¯è§†åŒ–', category:'æ•°æ®å¤„ç†' },
        { id:'plg-image', name:'å›¾åƒå¤„ç†', desc:'å‹ç¼©/æ»¤é•œ/è¯†åˆ«', category:'å¤šåª’ä½“' },
        { id:'plg-tts', name:'TTS å¼•æ“', desc:'æ–‡æœ¬è½¬è¯­éŸ³', category:'å¤šåª’ä½“' }
      ];

      const agentCategories = ['å…¨éƒ¨','æ•°æ®åˆ†æ','å†…å®¹åˆ›ä½œ','å¼€å‘å·¥å…·','ç ”ç©¶','å¤šåª’ä½“'];
      const pluginCategories = ['å…¨éƒ¨','æœç´¢å¼•æ“','API è¿æ¥å™¨','æ•°æ®å¤„ç†','å¤šåª’ä½“'];

      const selected = { agents: new Set(), plugins: new Set() };

      function renderBadges(){
        selectionBar.innerHTML = '';
        [...selected.agents].forEach(id=>{
          const item = agentCatalog.find(x=>x.id===id);
          if(!item) return;
          const b = document.createElement('span');
          b.className = 'badge';
          b.innerHTML = `${item.name}<span class="x" data-type="agent" data-id="${id}">âœ•</span>`;
          selectionBar.appendChild(b);
        });
        [...selected.plugins].forEach(id=>{
          const item = pluginCatalog.find(x=>x.id===id);
          if(!item) return;
          const b = document.createElement('span');
          b.className = 'badge';
          b.innerHTML = `${item.name}<span class="x" data-type="plugin" data-id="${id}">âœ•</span>`;
          selectionBar.appendChild(b);
        });
        selectionBar.querySelectorAll('.x').forEach(x=>{
          x.addEventListener('click', ()=>{
            const type = x.getAttribute('data-type');
            const id = x.getAttribute('data-id');
            if(type==='agent') selected.agents.delete(id); else selected.plugins.delete(id);
            renderBadges();
            renderAgentGrid();
            renderPluginGrid();
          });
        });
        // é€šçŸ¥å·¥ä½œå°å¾½ç« åŒæ­¥
        const evt = new Event('sync');
        selectionBar.dispatchEvent(evt);
      }

      function buildChips(container, categories, onPick){
        container.innerHTML = '';
        categories.forEach((c, idx)=>{
          const el = document.createElement('button');
          el.type = 'button';
          el.className = 'chip' + (idx===0 ? ' active' : '');
          el.textContent = c;
          el.addEventListener('click', ()=>{
            container.querySelectorAll('.chip').forEach(n=>n.classList.remove('active'));
            el.classList.add('active');
            onPick(c);
          });
          container.appendChild(el);
        });
      }

      let agentFilter = { q:'', cat:'å…¨éƒ¨' };
      let pluginFilter = { q:'', cat:'å…¨éƒ¨' };

      function renderAgentGrid(targetGrid = agentGridSquare){
        const q = agentFilter.q.trim().toLowerCase();
        const cat = agentFilter.cat;
        const list = agentCatalog.filter(a=>
          (cat==='å…¨éƒ¨'||a.category===cat) &&
          (!q || a.name.toLowerCase().includes(q) || a.desc.toLowerCase().includes(q))
        );
        targetGrid.innerHTML = '';
        list.forEach(a=>{
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h4>${a.name}</h4>
            <p>${a.desc}</p>
            <div class="meta"><span>${a.category}</span>
            <button class="select-btn ${selected.agents.has(a.id)?'selected':''}" data-id="${a.id}">${selected.agents.has(a.id)?'å·²é€‰æ‹©':'é€‰æ‹©'}</button></div>`;
          targetGrid.appendChild(card);
          const btn = card.querySelector('.select-btn');
          btn.addEventListener('click', ()=>{
            if(selected.agents.has(a.id)) selected.agents.delete(a.id); else selected.agents.add(a.id);
            renderAgentGrid(targetGrid);
            renderBadges();
          });
        });
      }

      function renderPluginGrid(targetGrid = pluginGridSquare){
        const q = pluginFilter.q.trim().toLowerCase();
        const cat = pluginFilter.cat;
        const list = pluginCatalog.filter(p=>
          (cat==='å…¨éƒ¨'||p.category===cat) &&
          (!q || p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q))
        );
        targetGrid.innerHTML = '';
        list.forEach(p=>{
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h4>${p.name}</h4>
            <p>${p.desc}</p>
            <div class="meta"><span>${p.category}</span>
            <button class="select-btn ${selected.plugins.has(p.id)?'selected':''}" data-id="${p.id}">${selected.plugins.has(p.id)?'å·²å¯ç”¨':'å¯ç”¨'}</button></div>`;
          targetGrid.appendChild(card);
          const btn = card.querySelector('.select-btn');
          btn.addEventListener('click', ()=>{
            if(selected.plugins.has(p.id)) selected.plugins.delete(p.id); else selected.plugins.add(p.id);
            renderPluginGrid(targetGrid);
            renderBadges();
          });
        });
      }

      // åˆå§‹åŒ–é¦–é¡µåŠŸèƒ½ï¼ˆå·²ç§»é™¤ï¼Œç°åœ¨ä½¿ç”¨å¹¿åœºé¡µé¢ï¼‰
      
      // åˆå§‹åŒ–å¹¿åœºé¡µé¢åŠŸèƒ½
      buildChips(agentChipsSquare, agentCategories, (c)=>{ agentFilter.cat=c; renderAgentGrid(agentGridSquare); });
      buildChips(pluginChipsSquare, pluginCategories, (c)=>{ pluginFilter.cat=c; renderPluginGrid(pluginGridSquare); });
      agentSearchSquare.addEventListener('input', ()=>{ agentFilter.q = agentSearchSquare.value; renderAgentGrid(agentGridSquare); });
      pluginSearchSquare.addEventListener('input', ()=>{ pluginFilter.q = pluginSearchSquare.value; renderPluginGrid(pluginGridSquare); });
      renderAgentGrid(agentGridSquare);
      renderPluginGrid(pluginGridSquare);
      renderBadges();
    })();
  </script>
  
</body>
</html>
